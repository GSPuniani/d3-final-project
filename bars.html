<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bar Graph</title>
    </head>
    <body>

        <svg id="svg" width="1000" height="700"></svg>

        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script>
            async function handleData() {
                const data = await d3.csv('acquisitions_update_2021.csv')
                const margin = { top: 10, right: 10, bottom: 20, left: 40 }
                const width = 1000 - (margin.left + margin.right)
                const height = 700 - (margin.top + margin.bottom)
                

                // Calculate total number of acquisitions for each company
                const getAcquisitionCountByCompany = (data, company) => {
                    const acquisitions = data.filter(acquisition => acquisition["Parent Company"] === company)
                    return acquisitions.length
                }

                // Create an object with unique parent companies
                const namesAndValues = Array.from(new Set(data.map(acquisition => acquisition["Parent Company"]))).map(name => {
                    return {name, value: 0}
                })
                // Add acquisition counts to the object
                namesAndValues.forEach((company) => company.value = getAcquisitionCountByCompany(data, company.name))
                
                // const namesAndValues = data.map(acquisition => {
                //     const acquisitions = getAcquisitionCountByCompany(data, acquisition["Parent Company"])
                //     return {name: acquisition["Parent Company"], value: acquisitions}
                // })
                console.log(namesAndValues)

                // x scale 
                const xscale = d3.scaleBand()
                    .domain(namesAndValues.map(d => d.name))
                    .range([margin.left, width + margin.left])
                    .padding(0.25)

                
                // y scale 
                const acquisitionExtent = d3.extent(namesAndValues, d => d.value)
                const yscale = d3.scaleLinear()
                    .domain(acquisitionExtent)
                    .range([height - margin.bottom, margin.top])


                // Select the SVG
                const svg = d3.select('#svg')

                const barGroup = svg.append('g')

                // Make the bars
                barGroup 
                    .selectAll('rect')
                    .data(namesAndValues)
                    .enter()
                    .append('rect')
                    .attr('class', 'bar')
                    .attr('x', (d, i) => xscale(d.name))
                    .attr('y', d => yscale(d.value))
                    .attr('width', xscale.bandwidth())
                    .attr('height', d => height - yscale(d.value))


                // Add bottom labels to x-axis
                const bottomAxis = d3.axisBottom(xscale)
                svg
                    .append('g')
                    .attr('transform', `translate(${0}, ${height})`)
                    .call(bottomAxis)


                // Add side labels to y-axis
                const leftAxis = d3.axisLeft(yscale)
                svg
                    .append('g')
                    .attr('transform', `translate(${margin.left}, 0)`)
                    .call(leftAxis)




            }

            handleData()



                

            

        </script>
    </body>
</html>
