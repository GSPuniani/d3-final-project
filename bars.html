<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bar Graph</title>
    </head>
    <body>

        <div>
            <p>Total acquisitions for all companies (1957 - 2021)</p>
            <svg id="svg1" width="1000" height="700"></svg>
        </div>

        <div>
            <p>Total acquisitions for one company (1957 - 2021)</p>
            <svg id="svg2" width="1000" height="700"></svg>
        </div>

        <div>
            <p>Total acquisitions for all companies over one year</p>
            <svg id="svg3" width="1000" height="700"></svg>
        </div>


        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script>
            async function handleData() {
                const data = await d3.csv('acquisitions_update_2021.csv')
                const margin = { top: 10, right: 10, bottom: 20, left: 40 }
                const width = 1000 - (margin.left + margin.right)
                const height = 700 - (margin.top + margin.bottom)
                

                // Calculate total number of acquisitions for each company
                const getAcquisitionCountByCompany = (data, company) => {
                    const acquisitions = data.filter(acquisition => acquisition["Parent Company"] === company)
                    return acquisitions.length
                }

                // Create an object with unique parent companies
                const namesAndValues = Array.from(new Set(data.map(acquisition => acquisition["Parent Company"]))).map(name => {
                    return {name, value: 0}
                })
                // Add acquisition counts to the object
                namesAndValues.forEach((company) => company.value = getAcquisitionCountByCompany(data, company.name))
                
                // const namesAndValues = data.map(acquisition => {
                //     const acquisitions = getAcquisitionCountByCompany(data, acquisition["Parent Company"])
                //     return {name: acquisition["Parent Company"], value: acquisitions}
                // })
                console.log(namesAndValues)

                // x scale 
                const xscale1 = d3.scaleBand()
                    .domain(namesAndValues.map(d => d.name))
                    .range([margin.left, width + margin.left])
                    .padding(0.25)

                
                // y scale 
                const acquisitionExtent = d3.extent(namesAndValues, d => d.value)
                const yscale1 = d3.scaleLinear()
                    .domain(acquisitionExtent)
                    .range([height - margin.bottom, margin.top])


                // Select the SVG
                const svg1 = d3.select('#svg1')

                const barGroup1 = svg1.append('g')

                // Make the bars
                barGroup1 
                    .selectAll('rect')
                    .data(namesAndValues)
                    .enter()
                    .append('rect')
                    .attr('class', 'bar')
                    .attr('x', (d, i) => xscale1(d.name))
                    .attr('y', d => yscale1(d.value))
                    .attr('width', xscale1.bandwidth())
                    .attr('height', d => height - yscale1(d.value))


                // Add bottom labels to x-axis
                const bottomAxis1 = d3.axisBottom(xscale1)
                svg1
                    .append('g')
                    .attr('transform', `translate(${0}, ${height})`)
                    .call(bottomAxis1)


                // Add side labels to y-axis
                const leftAxis1 = d3.axisLeft(yscale1)
                svg1
                    .append('g')
                    .attr('transform', `translate(${margin.left}, 0)`)
                    .call(leftAxis1)




                // Second bar graph

                const monthsInOrder = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "-"]

                // Calculate total number of acquisitions for each company
                const getAcquisitionCountByMonth = (data, month) => {
                    const acquisitions = data.filter(acquisition => (acquisition["Acquisition Month"] === month && 
                        acquisition["Acquisition Year"] === 2010))
                    return acquisitions.length
                }

                // Create an object with unique parent companies
                const monthsAndValues = Array.from(new Set(data.map(acquisition => acquisition["Acquisition Month"]))).map(name => {
                    return {name, value: 0}
                })
                // Add acquisition counts to the object
                monthsAndValues.forEach((month) => month.value = getAcquisitionCountByCompany(data, month))

                const orderedMonthsAndValues = Object.keys(monthsAndValues).sort().reduce(
                    (obj, key) => { 
                        obj[key] = monthsAndValues[key]; 
                        return obj;
                    }, 
                    {}
                );

                // x scale 
                const xscale2 = d3.scaleBand()
                    .domain(monthsAndValues.map(d => d.name))
                    .range([margin.left, width + margin.left])
                    .padding(0.25)

                
                // y scale 
                const acquisitionExtentByMonth = d3.extent(monthsAndValues, d => d.value)
                const yscale2 = d3.scaleLinear()
                    .domain(acquisitionExtentByMonth)
                    .range([height - margin.bottom, margin.top])


                // Select the SVG
                const svg2 = d3.select('#svg2')

                const barGroup2 = svg2.append('g')

                // Make the bars
                barGroup2 
                    .selectAll('rect')
                    .data(monthsAndValues)
                    .enter()
                    .append('rect')
                    .attr('class', 'bar')
                    .attr('x', (d, i) => {
                        console.log(d.name)
                        console.log(d)
                        console.log(xscale2(d.name))
                        return xscale2(d.name)
                    })
                    .attr('y', d => yscale2(d.value))
                    .attr('width', xscale2.bandwidth())
                    .attr('height', d => height - yscale2(d.value))


                // Add bottom labels to x-axis
                const bottomAxis2 = d3.axisBottom(xscale2)
                svg2
                    .append('g')
                    .attr('transform', `translate(${0}, ${height})`)
                    .call(bottomAxis2)


                // Add side labels to y-axis
                const leftAxis2 = d3.axisLeft(yscale2)
                svg2
                    .append('g')
                    .attr('transform', `translate(${margin.left}, 0)`)
                    .call(leftAxis2)

            }

            handleData()



                

            

        </script>
    </body>
</html>
